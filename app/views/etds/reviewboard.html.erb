<h1><%= link_to(@etd.title, etd_path(@etd)) %></h1>
By <%= @creators.map { |o| o.name } .join(", ") %>
<%= form_tag(controller: "conversations", action: "confirm_new") do %>
  <% @creators.pluck(:id).each do |id| %>
    <%= hidden_field_tag("participants[]", id) %>
  <% end %>
  <%= hidden_field_tag(:static_participants, 'true') %>
  <%= hidden_field_tag(:model_type, @etd.class.name) %>
  <%= hidden_field_tag(:model_id, @etd.id) %>
  <%= submit_tag("Send Message") %>
<% end %>
<h3>Committee Members</h3>
<table>
  <tr>
    <th>Role</th>
    <th>Name</th>
    <th>Vote</th>
  </tr>
  <% @collabs.each do |member| %>
  <tr>
    <td><%= member.role.name %></td>
    <td><%= member.person.name %></td>
    <% if member.vote.nil? %>
      <td>No Vote</td>
    <% else %>
      <td><%= member.vote ? 'Approve' : 'Disapprove' %></td>
    <% end %>
    <% if current_person.id == member.person.id %>
      <td>
        <%= form_tag(vote_for_etd_path(@etd)) do %>
          <%= select_tag(:vote, options_for_select([['Approve', true], ['Disapprove', false]])) %>
          <%= submit_tag('Vote') %>
        <% end %>
      </td>
    <% else %>
      <td>
        <%= form_tag(controller: "conversations", action: "confirm_new") do %>
          <%= hidden_field_tag("participants[]", member.person.id) %>
          <%= hidden_field_tag(:static_participants, 'true') %>
          <%= hidden_field_tag(:model_type, @etd.class.name) %>
          <%= hidden_field_tag(:model_id, @etd.id) %>
          <%= submit_tag("Send Message") %>
        <% end %>
      </td>
    <% end %>
  </tr>
  <% end %>
</table>
<% if !(current_person.roles & Role.where(group: ['Graduate School', 'Administration'])).empty? %>
<p>
  <%= button_to('Approve ETD', approve_etd_path(@etd)) %>
  <%= button_to('Unsubmit ETD', unsubmit_etd_path(@etd)) %>
</p>
<% end %>
