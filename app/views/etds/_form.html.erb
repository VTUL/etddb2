<%= form_for @etd do |f| %>
  <% if @etd.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@etd.errors.count, "error") %> prohibited this ETD from being saved:</h2>
      <ul>
      <% @etd.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field">
    <%= f.label(:document_type_id, "Document Type") %><br />
    <% if @is_admin %>
      <%= f.collection_select(:document_type_id, DocumentType.all, :id, :name) %>
    <% else %>
      <%= f.collection_select(:document_type_id, DocumentType.where(retired: false), :id, :name) %>
    <% end %>
  </div>
  <div class="field">
    <%= f.label(:title) %><br />
    <%= f.text_field(:title) %>
  </div>
  <div class="field">
    <%= f.label(:degree_id, "Degree") %><br />
    <% if @is_admin %>
      <%= f.collection_select(:degree_id, Degree.all, :id, :name) %>
    <% else %>
      <%= f.collection_select(:degree_id, Degree.where(retired: false), :id, :name) %>
    <% end %>
  </div>
  <div class="field">
    <%= f.label(:department_ids, "Departments") %><br />
    <%= f.fields_for :department_ids do |df| %>
      <% if @is_admin  %>
        <%= df.collection_select(:id_1, Department.all, :id, :name, {selected: @etd.department_ids[0],
                                 prompt: "Please pick your primary department."}) %><br />
        <%= df.collection_select(:id_2, Department.all, :id, :name, {selected: @etd.department_ids[1],
                                 prompt: "I do not have a secondary department."}) %>
      <% else %>
        <%= df.collection_select(:id_1, Department.where(retired: false), :id, :name, {selected: @etd.department_ids[0],
                                 prompt: "Please pick your primary department."}) %><br />
        <%= df.collection_select(:id_2, Department.where(retired: false), :id, :name, {selected: @etd.department_ids[1],
                                 prompt: "I do not have a secondary department."}) %>
      <% end %>
    <% end %>
  </div>
  <div class="field">
    <%= f.label(:keywords) %><br />
    <%= f.text_area(:keywords, rows: 5) %>
  </div>
  <div class="field">
    <%= f.label(:defense_date, "Defense Date") %><br />
    <%= f.date_select(:defense_date, {end_year: Time.now.year + 1}) %>
  </div>
  <div class="field">
    <%= f.label(:availability_id, "Availability") %>
    <table>
      <% for avail in @availabilities.each do %>
        <tr>
          <td valign='top'><%= f.radio_button(:availability_id, avail.id) %></td>
          <td valign='top' align='right'><%= avail.name %>:</td>
          <td valign='top'><%= avail.description %></td>
        </tr>
      <% end %>
    </table>
  </div>
  <div class="field">
    <%= f.label(:abstract) %><br />
    <%= f.text_area(:abstract) %>
  </div>
  <% if @is_admin %>
    <div class="field">
      <%= f.label(:copyright_statement_id, "Select a copyright statement:") %>
      <table>
        <tr>
          <td><%= f.radio_button(:copyright_statement_id, @copyright.id) %></td>
          <% # TODO: Make this field wider. %>
          <td><%= @copyright.created_at.strftime("%b %d %Y") %> to now</td>
          <td><%= @copyright.statement %></td>
        </tr>
        <% for copyright in CopyrightStatement.where(retired: true).order('retired_at DESC') do %>
          <tr>
            <td><%= f.radio_button(:copyright_statement_id, copyright.id) %></td>
            <% # TODO: Make this field wider. %>
            <td><%= copyright.created_at.strftime("%b %d %Y") %> to <%= copyright.retired_at.strftime("%b %d %Y") %></td>
            <td><%= copyright.statement %></td>
          </tr>
        <% end %>
      </table>
    </div>
    <div class="field">
      <%= f.label(:privacy_statement_id, "Select a privacy statement:") %>
      <table>
        <tr>
          <td><%= f.radio_button(:privacy_statement_id, @privacy.id) %></td>
          <% # TODO: Make this field wider. %>
          <td><%= @privacy.created_at.strftime("%b %d %Y") %> to now</td>
          <td><%= @privacy.statement %></td>
        </tr>
        <% for privacy in PrivacyStatement.where(retired: true).order('retired_at DESC') do %>
          <tr>
            <td><%= f.radio_button(:privacy_statement_id, privacy.id) %></td>
            <% # TODO: Make this field wider. %>
            <td><%= privacy.created_at.strftime("%b %d %Y") %> to <%= privacy.retired_at.strftime("%b %d %Y") %></td>
            <td><%= privacy.statement %></td>
          </tr>
        <% end %>
      </table>
    </div>
    <div class="field">
      <%= f.check_box(:bound) %>
      <%= f.label(:bound, 'This ETD was bound.') %>
    </div>
  <% else %>
    <div class="field">
      <%= @copyright.statement %><br />
      <%= f.check_box(:copyright_statement_id, {}, @copyright.id, nil)%>
      <%= f.label(:copyright_statement_id, "I have read the above and agreed to it.")%>
    </div>
    <div class="field">
      <%= @privacy.statement %><br />
      <%= f.check_box(:privacy_statement_id, {}, @privacy.id, nil)%>
      <%= f.label(:privacy_statement_id, "I have read the above and agreed to it.")%>
    </div>
    <%= f.hidden_field(:bound, {value: 0}) %>
  <% end %>

  <div class='actions'>
    <%= f.submit %>
  </div>
<% end %>
